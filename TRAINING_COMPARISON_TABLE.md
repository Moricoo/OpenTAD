# AdaTAD 训练配置对比表

## 数据集配置对比

| 配置项 | 训练集 | 验证集 | 测试集 |
|--------|--------|--------|--------|
| **帧采样方法** | Random Truncation | Sliding Window | Sliding Window |
| **窗口大小** | 768 frames | 768 frames | 768 frames |
| **截取长度** | 768 (trunc_thresh=0.75) | - | - |
| **剪裁方式** | Random Resized Crop | Center Crop | Center Crop |
| **剪裁比例** | [0.9, 1.0] | 160×160 | 160×160 |
| **输入分辨率** | 160×160 | 160×160 | 160×160 |
| **数据增强** | Flip, ColorJitter, ImgAug | 无 | 无 |
| **解码线程数** | 12 | 8 | 8 |

---

## 模型配置对比

| 配置项 | 数值 |
|--------|------|
| **Backbone** | VideoMAE-S (ViT-Small) |
| **输入帧数** | 768 frames (48 chunks × 16) |
| **Patch大小** | 16×16 |
| **嵌入维度** | 384 |
| **Transformer层数** | 12 |
| **注意力头数** | 6 |
| **Adapter层数** | 12 (所有层) |
| **激活检查点** | 启用 |

---

## 训练配置对比（32GB vs 64GB显存）

| 配置项 | 32GB显存 | 64GB显存 | 变化 |
|--------|----------|----------|------|
| **训练Batch Size** | 4 | 8 | ↑ 2× |
| **训练Num Workers** | 6 | 12 | ↑ 2× |
| **训练Prefetch Factor** | 4 | 6 | ↑ 1.5× |
| **验证Batch Size** | 1 | 2 | ↑ 2× |
| **验证Num Workers** | 0 | 4 | ↑ ∞ |
| **测试Batch Size** | 1 | 2 | ↑ 2× |
| **测试Num Workers** | 0 | 4 | ↑ ∞ |
| **解码线程数(训练)** | 8 | 12 | ↑ 1.5× |
| **解码线程数(验证)** | 4 | 8 | ↑ 2× |

---

## 训练超参数

| 配置项 | 数值 |
|--------|------|
| **优化器** | AdamW |
| **基础学习率** | 1e-4 |
| **权重衰减** | 0.05 |
| **Backbone学习率** | 0 (冻结) |
| **Adapter学习率** | 2e-4 |
| **学习率调度** | LinearWarmupCosineAnnealingLR |
| **Warmup Epochs** | 5 |
| **最大Epochs** | 100 |
| **混合精度训练** | AMP (fp16) |
| **梯度裁剪** | 1.0 |
| **EMA** | 启用 |
| **静态图优化** | 启用 |

---

## 训练结果对比

### Loss变化趋势

| Epoch | Total Loss | cls_loss | reg_loss | 变化 |
|-------|------------|----------|----------|------|
| 48 | 0.5085 | 0.2663 | 0.2422 | - |
| 49 | 0.4017 | 0.2115 | 0.1902 | ↓ 21.0% |
| 50 | 0.3644 | 0.1947 | 0.1697 | ↓ 9.3% |
| 51 | 0.4014 | 0.2098 | 0.1917 | ↑ 10.1% |
| 52 | 0.3976 | 0.2068 | 0.1908 | ↓ 0.9% |
| 53 | 0.3641 | 0.1881 | 0.1760 | ↓ 8.4% |
| 54 | 0.3817 | 0.1991 | 0.1826 | ↑ 4.8% |
| 55 | 0.4143 | 0.2165 | 0.1978 | ↑ 8.5% |
| 56 | 0.3661 | 0.1914 | 0.1747 | ↓ 11.6% |
| 57 | 0.3779 | 0.1979 | 0.1800 | ↑ 3.2% |
| 58 | 0.3810 | 0.1983 | 0.1827 | ↑ 0.8% |
| 59 | 0.3768 | 0.1987 | 0.1781 | ↓ 1.1% |

**Loss统计：**
- 初始Loss (Epoch 48): 0.5085
- 最终Loss (Epoch 59): 0.3768
- 总体下降: 25.9%
- 平均Loss: 0.3896
- Loss标准差: 0.0374

### mAP变化趋势

| Epoch | Average-mAP | mAP@0.3 | mAP@0.4 | mAP@0.5 | mAP@0.6 | mAP@0.7 | 变化 |
|-------|-------------|---------|---------|---------|---------|---------|------|
| 49 | 68.48% | - | - | - | - | - | - |
| 51 | 68.51% | - | - | - | - | - | ↑ 0.03% |
| 53 | 68.51% | - | - | - | - | - | → 0.00% |
| 55 | 68.54% | - | - | - | - | - | ↑ 0.03% |
| 57 | 68.60% | 83.48% | 79.51% | 71.12% | 62.00% | 46.90% | ↑ 0.06% |
| 59 | 68.64% | 83.50% | 79.55% | 71.28% | 61.95% | 46.94% | ↑ 0.04% |

**mAP统计：**
- 初始mAP (Epoch 49): 68.48%
- 最终mAP (Epoch 59): 68.64%
- 总体提升: +0.16%
- 最佳mAP: 68.64% (Epoch 59)

---

## 性能指标总结

### 最终性能 (Epoch 59)

| 指标 | 数值 |
|------|------|
| **Average-mAP** | **68.64%** |
| **mAP@0.3** | 83.50% |
| **mAP@0.4** | 79.55% |
| **mAP@0.5** | 71.28% |
| **mAP@0.6** | 61.95% |
| **mAP@0.7** | 46.94% |

### 训练效率

| 指标 | 数值 |
|------|------|
| **GPU利用率** | 100% |
| **CPU利用率** | 85-90% |
| **GPU显存使用** | ~12.2 GB / 32 GB (38%) |
| **每个Epoch时间** | 12-14分钟 (含验证) |
| **模型大小** | 595 MB |

---

## 关键发现

1. **Loss收敛**: 从0.5085降至0.3768，下降25.9%，训练稳定
2. **mAP提升**: 从68.48%提升至68.64%，提升0.16%，模型接近收敛
3. **显存优化**: 64GB配置下batch size和workers翻倍，训练效率显著提升
4. **性能稳定**: Loss在0.36-0.41之间波动，mAP稳定在68.5%左右

---

**生成时间**: 2025-11-22
**训练曲线图**: `training_curves.png`
**详细报告**: `TRAINING_SUMMARY.md`

