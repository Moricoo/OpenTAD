# 存储空间分析与扩容建议

## 📊 当前存储情况

### 磁盘分区情况

| 分区 | 挂载点 | 总容量 | 已使用 | 可用空间 | 使用率 |
|------|--------|--------|--------|----------|--------|
| /dev/vda2 | /root | 40GB | 25GB | 13GB | 66% |
| /dev/vdb | /data | 492GB | 173GB | 294GB | 37% |

### 当前data目录状态

- **位置**: `/root/OpenTAD/data`
- **当前大小**: 几乎为空（只有目录结构，约3MB）
- **挂载分区**: `/root` (40GB分区)

---

## 📦 数据集存储需求估算

### 原始视频数据集大小

| 数据集 | 原始视频大小 | 特征文件大小 | 推荐存储 |
|--------|-------------|-------------|----------|
| **THUMOS-14** | 100-200GB | 10-50GB | 200GB |
| **ActivityNet-1.3** | 500GB-1TB | 50-200GB | 1TB |
| **EPIC-KITCHENS-100** | 500GB-1TB | 50-200GB | 1TB |
| **Charades** | 50-100GB | 5-20GB | 100GB |
| **Ego4D** | 1-2TB | 100-500GB | 2TB |

### 特征文件大小（预处理后）

- **I3D特征**: 通常为原始视频的10-20%
- **VideoMAE特征**: 通常为原始视频的20-40%
- **TSN特征**: 通常为原始视频的5-10%

---

## 🎯 扩容需求分析

### 场景1: 只训练一个数据集（如ActivityNet-1.3）

**需求**:
- 原始视频: 500GB-1TB
- 特征文件: 50-200GB
- 训练checkpoint: 10-50GB
- **总计**: 约 **600GB-1.2TB**

**当前可用空间**:
- `/root`: 13GB ❌ **不足**
- `/data`: 294GB ⚠️ **可能不足**（如果下载完整数据集）

**建议**:
- 如果只使用特征文件: 需要 **200-300GB**，当前 `/data` 分区足够
- 如果下载原始视频: 需要扩容 **至少500GB**

### 场景2: 训练多个数据集

**需求**:
- ActivityNet-1.3: 1TB
- EPIC-KITCHENS-100: 1TB
- THUMOS-14: 200GB
- **总计**: 约 **2.2TB**

**建议**: 需要扩容 **至少1.5TB**

### 场景3: 只使用特征文件（推荐）

**需求**:
- ActivityNet特征: 50-200GB
- EPIC-KITCHENS特征: 50-200GB
- THUMOS-14特征: 10-50GB
- **总计**: 约 **200-500GB**

**当前可用空间**: `/data` 分区有294GB，**基本足够**

---

## 💡 扩容建议

### 方案1: 使用现有/data分区（推荐）✅

**优点**:
- `/data` 分区已有294GB可用空间
- 不需要扩容，直接使用

**操作**:
```bash
# 创建软链接，将data目录指向/data分区
mkdir -p /data/OpenTAD
mv /root/OpenTAD/data /data/OpenTAD/
ln -s /data/OpenTAD/data /root/OpenTAD/data
```

**适用场景**:
- 只使用特征文件（200-500GB）
- 单个数据集训练

### 方案2: 扩容/data分区

**如果下载完整原始视频数据集**:

| 数据集数量 | 需要空间 | 建议扩容到 |
|-----------|---------|-----------|
| 1个数据集 | 1TB | 1.5TB (总容量) |
| 2个数据集 | 2TB | 2.5TB (总容量) |
| 3个数据集 | 3TB | 3.5TB (总容量) |

**当前/data**: 492GB总容量，173GB已用，294GB可用

**扩容计算**:
- 如果下载ActivityNet-1.3完整数据集（1TB）:
  - 需要: 1TB
  - 当前可用: 294GB
  - **需要扩容**: 至少 **700GB** (约1TB总容量 → 1.5TB总容量)

### 方案3: 扩容/root分区（不推荐）

**不推荐原因**:
- `/root` 分区只有40GB，空间有限
- 扩容操作复杂，风险较高
- 建议使用独立的 `/data` 分区

---

## 📋 具体扩容建议

### 如果只使用特征文件（推荐）

✅ **不需要扩容**
- 使用 `/data` 分区的294GB可用空间
- 将data目录迁移到 `/data` 分区

### 如果下载完整原始视频

#### 单个数据集（如ActivityNet-1.3）

**需要扩容**: `/data` 分区从492GB扩容到 **1.5TB**

**计算**:
- 当前: 492GB总容量，173GB已用，294GB可用
- 需要: 1TB (原始视频) + 200GB (特征) + 100GB (缓冲) = 1.3TB
- 建议总容量: **1.5TB**
- **需要扩容**: 1.5TB - 492GB = **约1TB**

#### 多个数据集

**需要扩容**: `/data` 分区从492GB扩容到 **2.5TB-3TB**

---

## 🚀 推荐方案

### 最佳方案: 使用特征文件 + 迁移到/data分区

**步骤**:

1. **迁移data目录到/data分区**:
```bash
# 创建目录
mkdir -p /data/OpenTAD

# 迁移数据
mv /root/OpenTAD/data /data/OpenTAD/

# 创建软链接
ln -s /data/OpenTAD/data /root/OpenTAD/data
```

2. **使用特征文件而非原始视频**:
   - 特征文件通常只有原始视频的10-40%
   - 训练速度更快
   - 存储需求更小

3. **如果空间不足，再考虑扩容**

---

## 📊 存储使用监控

### 查看当前使用情况

```bash
# 查看磁盘使用
df -h

# 查看data目录大小
du -sh /root/OpenTAD/data
du -sh /data/OpenTAD/data  # 如果已迁移

# 查看各数据集大小
du -sh /root/OpenTAD/data/*

# 实时监控
watch -n 5 'df -h && echo "---" && du -sh /root/OpenTAD/data/*'
```

---

## ⚠️ 注意事项

1. **预留缓冲空间**: 建议保留至少20%的可用空间作为缓冲
2. **定期清理**: 删除不需要的checkpoint和临时文件
3. **压缩存储**: 对于不常用的数据集，可以考虑压缩存储
4. **外部存储**: 对于非常大的数据集，考虑使用外部存储或对象存储

---

## 📝 总结

### 当前状态
- `/root`: 40GB，剩余13GB（不足）
- `/data`: 492GB，剩余294GB（可用）

### 推荐操作

1. **短期方案**（不需要扩容）:
   - 将data目录迁移到 `/data` 分区
   - 使用特征文件而非原始视频
   - 294GB可用空间足够1-2个数据集的特征文件

2. **长期方案**（如需要完整数据集）:
   - 扩容 `/data` 分区到 **1.5TB-2TB**
   - 或使用外部存储/对象存储

### 扩容需求总结

| 使用场景 | 需要空间 | 当前可用 | 需要扩容 |
|---------|---------|---------|---------|
| 特征文件（1-2个数据集） | 200-500GB | 294GB | ❌ 不需要 |
| 完整数据集（1个） | 1TB | 294GB | ✅ 约700GB |
| 完整数据集（2个） | 2TB | 294GB | ✅ 约1.5TB |

