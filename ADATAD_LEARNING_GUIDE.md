# AdaTAD å­¦ä¹ æŒ‡å—

## ğŸ“š ä»€ä¹ˆæ˜¯ AdaTADï¼Ÿ

**AdaTAD** (Adaptive Temporal Action Detection) æ˜¯ä¸€ä¸ªç«¯åˆ°ç«¯çš„æ—¶åºåŠ¨ä½œæ£€æµ‹æ¨¡å‹ï¼Œè®ºæ–‡æ ‡é¢˜ä¸ºï¼š
> **"End-to-End Temporal Action Detection with 1B Parameters Across 1000 Frames"**

### æ ¸å¿ƒè´¡çŒ®

1. **è§£å†³å†…å­˜ç“¶é¢ˆé—®é¢˜**ï¼šé€šè¿‡åˆ›æ–°çš„ **TIA (Temporal-Informative Adapter)** æ¨¡å—ï¼Œå¤§å¹…é™ä½ç«¯åˆ°ç«¯è®­ç»ƒçš„å†…å­˜æ¶ˆè€—
2. **æ‰©å±•æ¨¡å‹è§„æ¨¡**ï¼šèƒ½å¤Ÿè®­ç»ƒ 10 äº¿å‚æ•°çš„éª¨å¹²ç½‘ç»œï¼ˆVideoMAEv2-giantï¼‰
3. **æ‰©å±•è¾“å…¥é•¿åº¦**ï¼šæ”¯æŒå¤„ç† 1,536 å¸§çš„é•¿è§†é¢‘
4. **æ€§èƒ½çªç ´**ï¼šåœ¨ THUMOS-14 ä¸Šè¾¾åˆ° 75.4% mAPï¼Œé¦–æ¬¡è¶…è¶ŠåŸºäºç‰¹å¾çš„æ–¹æ³•

### è®ºæ–‡ä¿¡æ¯

- **ä½œè€…**: Shuming Liu, Chen-Lin Zhang, Chen Zhao, Bernard Ghanem
- **ä¼šè®®**: CVPR 2024
- **è®ºæ–‡é“¾æ¥**: https://arxiv.org/abs/2311.17241
- **ä»£ç **: OpenTAD æ¡†æ¶ä¸­çš„ `configs/adatad/`

---

## ğŸ”‘ æ ¸å¿ƒæ¦‚å¿µ

### 1. Temporal-Informative Adapter (TIA)

**TIA** æ˜¯ AdaTAD çš„æ ¸å¿ƒåˆ›æ–°ï¼Œæ˜¯ä¸€ä¸ªè½»é‡çº§çš„é€‚é…å™¨æ¨¡å—ï¼š

- **ä½œç”¨**ï¼šå‡å°‘è®­ç»ƒå†…å­˜ï¼ŒåŒæ—¶æå‡ TAD è¡¨ç¤ºèƒ½åŠ›
- **åŸç†**ï¼š
  - å†»ç»“å¤§å‹éª¨å¹²ç½‘ç»œï¼ˆbackboneï¼‰ï¼Œåªæ›´æ–° TIA ä¸­çš„å‚æ•°
  - åœ¨éª¨å¹²ç½‘ç»œçš„æ¯ä¸€å±‚ä¸­èšåˆç›¸é‚»å¸§çš„æ—¶åºä¸Šä¸‹æ–‡ä¿¡æ¯
  - é€šè¿‡æ—¶åºèšåˆè·å¾—æ›´å¥½çš„åŠ¨ä½œæ£€æµ‹è¡¨ç¤º

### 2. ç«¯åˆ°ç«¯è®­ç»ƒ (End-to-End Training)

- **ä¼ ç»Ÿæ–¹æ³•**ï¼šå…ˆæå–ç‰¹å¾ï¼ˆå¦‚ I3Dï¼‰ï¼Œå†è®­ç»ƒæ£€æµ‹å™¨
- **AdaTAD**ï¼šç›´æ¥ä»åŸå§‹è§†é¢‘è®­ç»ƒï¼Œç«¯åˆ°ç«¯ä¼˜åŒ–
- **ä¼˜åŠ¿**ï¼šç‰¹å¾æå–å’Œæ£€æµ‹ä»»åŠ¡è”åˆä¼˜åŒ–ï¼Œæ€§èƒ½æ›´å¥½

### 3. é€‚é…å™¨æœºåˆ¶ (Adapter Mechanism)

```python
# é…ç½®ç¤ºä¾‹ï¼ˆæ¥è‡ªé…ç½®æ–‡ä»¶ï¼‰
backbone=dict(
    type="VisionTransformerAdapter",  # ä½¿ç”¨é€‚é…å™¨ç‰ˆæœ¬çš„ ViT
    adapter_index=list(range(12)),     # åœ¨æ‰€æœ‰ 12 å±‚ä¸­æ’å…¥é€‚é…å™¨
    # ...
)
optimizer = dict(
    backbone=dict(
        lr=0,  # éª¨å¹²ç½‘ç»œå­¦ä¹ ç‡ä¸º 0ï¼ˆå†»ç»“ï¼‰
        custom=[dict(name="adapter", lr=2e-4)],  # åªè®­ç»ƒé€‚é…å™¨
    ),
)
```

---

## ğŸ—ï¸ æ¨¡å‹æ¶æ„

### æ•´ä½“ç»“æ„

```
è¾“å…¥è§†é¢‘ (768å¸§, 160x160)
    â†“
VideoMAE Backbone (å†»ç»“)
    â†“
TIA Adapters (å¯è®­ç»ƒ) â† åœ¨æ¯ä¸€å±‚æ’å…¥
    â†“
ç‰¹å¾æå– (384ç»´)
    â†“
ActionFormer æ£€æµ‹å¤´
    â†“
åŠ¨ä½œæ£€æµ‹ç»“æœ
```

### å…³é”®ç»„ä»¶

1. **VideoMAE Backbone**
   - é¢„è®­ç»ƒçš„è§†è§‰ Transformer
   - æ”¯æŒå¤šç§è§„æ¨¡ï¼šS, B, L, H, Giant
   - è¾“å…¥ï¼š16 å¸§çš„ç‰‡æ®µ

2. **TIA Adapter**
   - è½»é‡çº§æ¨¡å—
   - æ—¶åºä¿¡æ¯èšåˆ
   - ä½ç½®ï¼šæ¯ä¸ª Transformer å±‚ä¸­

3. **ActionFormer æ£€æµ‹å¤´**
   - æ—¶åºåŠ¨ä½œæ£€æµ‹å™¨
   - è¾“å‡ºï¼šåŠ¨ä½œç‰‡æ®µå’Œç±»åˆ«

---

## ğŸ“Š æ€§èƒ½è¡¨ç°

### THUMOS-14 æ•°æ®é›†ç»“æœ

| æ¨¡å‹ | mAP@0.3 | mAP@0.4 | mAP@0.5 | mAP@0.6 | mAP@0.7 | ave. mAP |
|------|---------|---------|---------|---------|---------|----------|
| VideoMAE-S | 83.90 | 79.01 | 72.38 | 61.57 | 48.27 | 69.03 |
| VideoMAE-B | 85.95 | 81.86 | 75.02 | 63.29 | 49.56 | 71.14 |
| VideoMAE-L | 87.17 | 83.58 | 76.88 | 66.81 | 53.13 | 73.51 |
| VideoMAE-H | 88.42 | 84.63 | 78.72 | 69.04 | 53.95 | 74.95 |
| VideoMAEv2-g | 88.63 | 85.39 | 79.17 | 68.34 | 53.79 | 75.06 |
| VideoMAEv2-g (1536å¸§) | 89.93 | 86.83 | 81.24 | 69.97 | 57.36 | **77.07** |

---

## ğŸ’» ä»£ç ç»“æ„

### é…ç½®æ–‡ä»¶ä½ç½®

```
OpenTAD/
â”œâ”€â”€ configs/
â”‚   â””â”€â”€ adatad/
â”‚       â”œâ”€â”€ README.md                    # è¯¦ç»†æ–‡æ¡£
â”‚       â”œâ”€â”€ thumos/                      # THUMOS-14 é…ç½®
â”‚       â”‚   â””â”€â”€ e2e_thumos_videomae_s_768x1_160_adapter.py
â”‚       â”œâ”€â”€ anet/                        # ActivityNet é…ç½®
â”‚       â”œâ”€â”€ epic/                        # EPIC-Kitchens é…ç½®
â”‚       â””â”€â”€ ...
â””â”€â”€ opentad/
    â””â”€â”€ models/
        â””â”€â”€ backbones/
            â””â”€â”€ vit_adapter.py           # TIA å®ç°
```

### å…³é”®ä»£ç æ–‡ä»¶

1. **é€‚é…å™¨å®ç°**: `opentad/models/backbones/vit_adapter.py`
2. **é…ç½®æ–‡ä»¶**: `configs/adatad/thumos/e2e_thumos_videomae_s_768x1_160_adapter.py`
3. **è®­ç»ƒè„šæœ¬**: `tools/train.py`
4. **æµ‹è¯•è„šæœ¬**: `tools/test.py`

---

## ğŸ“ å­¦ä¹ è·¯å¾„

### é˜¶æ®µ 1: åŸºç¡€ç†è§£ï¼ˆ1-2 å¤©ï¼‰

1. **é˜…è¯»è®ºæ–‡æ‘˜è¦å’Œå¼•è¨€**
   - ç†è§£æ—¶åºåŠ¨ä½œæ£€æµ‹çš„åŸºæœ¬é—®é¢˜
   - äº†è§£ç«¯åˆ°ç«¯è®­ç»ƒçš„ä¼˜åŠ¿å’ŒæŒ‘æˆ˜
   - ç†è§£å†…å­˜ç“¶é¢ˆé—®é¢˜

2. **äº†è§£ç›¸å…³æŠ€æœ¯**
   - VideoMAEï¼šè§†é¢‘è‡ªç›‘ç£å­¦ä¹ 
   - ActionFormerï¼šæ—¶åºåŠ¨ä½œæ£€æµ‹å™¨
   - Adapterï¼šå‚æ•°é«˜æ•ˆå¾®è°ƒæ–¹æ³•

### é˜¶æ®µ 2: æ·±å…¥ç†è§£ï¼ˆ3-5 å¤©ï¼‰

1. **é˜…è¯»è®ºæ–‡æ–¹æ³•éƒ¨åˆ†**
   - TIA æ¨¡å—çš„è®¾è®¡åŸç†
   - æ—¶åºä¿¡æ¯èšåˆæœºåˆ¶
   - è®­ç»ƒç­–ç•¥å’Œä¼˜åŒ–æ–¹æ³•

2. **åˆ†æä»£ç å®ç°**
   ```bash
   # æŸ¥çœ‹é€‚é…å™¨å®ç°
   cat opentad/models/backbones/vit_adapter.py

   # æŸ¥çœ‹é…ç½®æ–‡ä»¶
   cat configs/adatad/thumos/e2e_thumos_videomae_s_768x1_160_adapter.py
   ```

3. **ç†è§£è®­ç»ƒæµç¨‹**
   - æ•°æ®åŠ è½½å’Œé¢„å¤„ç†
   - æ¨¡å‹å‰å‘ä¼ æ’­
   - æŸå¤±å‡½æ•°å’Œä¼˜åŒ–

### é˜¶æ®µ 3: å®è·µæ“ä½œï¼ˆ1-2 å‘¨ï¼‰

1. **è¿è¡Œå°æ¨¡å‹å®éªŒ**
   ```bash
   # è®­ç»ƒ VideoMAE-Sï¼ˆå°æ¨¡å‹ï¼‰
   torchrun --nnodes=1 --nproc_per_node=1 \
       tools/train.py \
       configs/adatad/thumos/e2e_thumos_videomae_s_768x1_160_adapter.py
   ```

2. **åˆ†æè®­ç»ƒæ—¥å¿—**
   - è§‚å¯ŸæŸå¤±å˜åŒ–
   - æ£€æŸ¥å†…å­˜ä½¿ç”¨
   - éªŒè¯æ€§èƒ½æŒ‡æ ‡

3. **å°è¯•ä¸åŒé…ç½®**
   - è°ƒæ•´å­¦ä¹ ç‡
   - ä¿®æ”¹é€‚é…å™¨ä½ç½®
   - å®éªŒä¸åŒçš„éª¨å¹²ç½‘ç»œ

### é˜¶æ®µ 4: æ·±å…¥ç ”ç©¶ï¼ˆæŒç»­ï¼‰

1. **é˜…è¯»å®Œæ•´è®ºæ–‡**
2. **å¤ç°å®éªŒç»“æœ**
3. **å°è¯•æ”¹è¿›æ–¹æ³•**
4. **åº”ç”¨åˆ°å…¶ä»–æ•°æ®é›†**

---

## ğŸ“– æ¨èå­¦ä¹ èµ„æº

### è®ºæ–‡å’Œæ–‡æ¡£

1. **AdaTAD è®ºæ–‡**
   - arXiv: https://arxiv.org/abs/2311.17241
   - CVPR 2024 ä¼šè®®è®ºæ–‡

2. **ç›¸å…³è®ºæ–‡**
   - VideoMAE: https://arxiv.org/abs/2203.12602
   - ActionFormer: https://arxiv.org/abs/2202.07925
   - Adapter æ–¹æ³•: Parameter-Efficient Transfer Learning

3. **OpenTAD æ–‡æ¡£**
   - `configs/adatad/README.md` - è¯¦ç»†é…ç½®è¯´æ˜
   - `docs/en/` - æ¡†æ¶æ–‡æ¡£

### ä»£ç èµ„æº

1. **OpenTAD ä»£ç åº“**
   - GitHub: https://github.com/OpenGVLab/OpenTAD
   - é…ç½®æ–‡ä»¶: `configs/adatad/`

2. **å…³é”®å®ç°**
   - TIA é€‚é…å™¨: `opentad/models/backbones/vit_adapter.py`
   - è®­ç»ƒè„šæœ¬: `tools/train.py`

### è§†é¢‘æ•™ç¨‹

- CVPR 2024 è®ºæ–‡è®²è§£ï¼ˆå¦‚æœæœ‰ï¼‰
- VideoMAE ç›¸å…³æ•™ç¨‹
- Transformer å’Œ Adapter æœºåˆ¶è®²è§£

---

## ğŸ” å…³é”®æŠ€æœ¯ç»†èŠ‚

### 1. é€‚é…å™¨æ’å…¥ä½ç½®

```python
# åœ¨æ‰€æœ‰ Transformer å±‚ä¸­æ’å…¥é€‚é…å™¨
adapter_index=list(range(12))  # 12 å±‚å…¨éƒ¨æ’å…¥
```

### 2. è®­ç»ƒç­–ç•¥

- **å†»ç»“éª¨å¹²ç½‘ç»œ**: `backbone.lr=0`
- **åªè®­ç»ƒé€‚é…å™¨**: `adapter.lr=2e-4`
- **æ¿€æ´»æ£€æŸ¥ç‚¹**: `with_cp=True` (èŠ‚çœå†…å­˜)
- **æ··åˆç²¾åº¦**: `amp=True`
- **FP16 å‹ç¼©**: `fp16_compress=True`

### 3. æ•°æ®å¤„ç†

- **çª—å£å¤§å°**: 768 å¸§
- **å›¾åƒå°ºå¯¸**: 160x160
- **åˆ†å—å¤„ç†**: 768/16 = 48 ä¸ªå—ï¼ˆæ¯ä¸ªå— 16 å¸§ï¼‰
- **æ»‘åŠ¨çª—å£**: æµ‹è¯•æ—¶ä½¿ç”¨

### 4. å†…å­˜ä¼˜åŒ–æŠ€æœ¯

1. **æ¿€æ´»æ£€æŸ¥ç‚¹** (Activation Checkpointing)
2. **æ··åˆç²¾åº¦è®­ç»ƒ** (AMP)
3. **FP16 æ¢¯åº¦å‹ç¼©**
4. **é™æ€è®¡ç®—å›¾** (Static Graph)

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å‡†å¤‡æ•°æ®

```bash
# ä¸‹è½½è§†é¢‘æ•°æ®åˆ°
/data/thumos-14/videos/

# è¿è¡Œè®¾ç½®è„šæœ¬
bash scripts/utils/setup_video_data.sh
```

### 2. è®­ç»ƒæ¨¡å‹

```bash
cd /root/OpenTAD
source /root/miniconda3/bin/activate opentad

# è®­ç»ƒ VideoMAE-Sï¼ˆå°æ¨¡å‹ï¼Œé€‚åˆå­¦ä¹ ï¼‰
torchrun \
    --nnodes=1 \
    --nproc_per_node=1 \
    --rdzv_backend=c10d \
    --rdzv_endpoint=localhost:0 \
    tools/train.py \
    configs/adatad/thumos/e2e_thumos_videomae_s_768x1_160_adapter.py
```

### 3. æµ‹è¯•æ¨¡å‹

```bash
torchrun \
    --nnodes=1 \
    --nproc_per_node=1 \
    --rdzv_backend=c10d \
    --rdzv_endpoint=localhost:0 \
    tools/test.py \
    configs/adatad/thumos/e2e_thumos_videomae_s_768x1_160_adapter.py \
    --checkpoint exps/thumos/adatad/e2e_actionformer_videomae_s_768x1_160_adapter/gpu1_id0/checkpoint/best.pth
```

---

## ğŸ’¡ å­¦ä¹ å»ºè®®

1. **ä»ç®€å•å¼€å§‹**ï¼šå…ˆè¿è¡Œ VideoMAE-S å°æ¨¡å‹ï¼Œç†è§£æµç¨‹
2. **é˜…è¯»ä»£ç **ï¼šç»“åˆè®ºæ–‡é˜…è¯»ä»£ç å®ç°ï¼Œç†è§£ç»†èŠ‚
3. **å®éªŒå¯¹æ¯”**ï¼šå°è¯•ä¸åŒçš„é…ç½®ï¼Œè§‚å¯Ÿæ•ˆæœå˜åŒ–
4. **è®°å½•ç¬”è®°**ï¼šè®°å½•å…³é”®æ¦‚å¿µå’Œå®éªŒç»“æœ
5. **å‚ä¸è®¨è®º**ï¼šåœ¨ GitHub Issues æˆ–ç›¸å…³è®ºå›æé—®

---

## ğŸ“ å…³é”®æ¦‚å¿µé€ŸæŸ¥

| æœ¯è¯­ | è¯´æ˜ |
|------|------|
| **TAD** | Temporal Action Detectionï¼Œæ—¶åºåŠ¨ä½œæ£€æµ‹ |
| **TIA** | Temporal-Informative Adapterï¼Œæ—¶åºä¿¡æ¯é€‚é…å™¨ |
| **E2E** | End-to-Endï¼Œç«¯åˆ°ç«¯ |
| **VideoMAE** | è§†é¢‘æ©ç è‡ªç¼–ç å™¨ï¼Œç”¨äºè§†é¢‘é¢„è®­ç»ƒ |
| **Adapter** | é€‚é…å™¨ï¼Œå‚æ•°é«˜æ•ˆçš„å¾®è°ƒæ–¹æ³• |
| **mAP** | mean Average Precisionï¼Œå¹³å‡ç²¾åº¦å‡å€¼ |
| **Window Size** | çª—å£å¤§å°ï¼Œå¤„ç†çš„å¸§æ•°ï¼ˆå¦‚ 768 å¸§ï¼‰ |
| **Chunk** | åˆ†å—ï¼ŒVideoMAE æ¯æ¬¡å¤„ç† 16 å¸§ |

---

## ğŸ¯ ä¸‹ä¸€æ­¥

1. âœ… é˜…è¯»è®ºæ–‡æ‘˜è¦å’Œå¼•è¨€
2. âœ… ç†è§£ TIA é€‚é…å™¨æœºåˆ¶
3. âœ… æŸ¥çœ‹é…ç½®æ–‡ä»¶ç»“æ„
4. â³ è¿è¡Œå°æ¨¡å‹å®éªŒ
5. â³ åˆ†æè®­ç»ƒè¿‡ç¨‹
6. â³ å°è¯•æ”¹è¿›å’Œä¼˜åŒ–

---

**ç¥ä½ å­¦ä¹ é¡ºåˆ©ï¼** ğŸš€

å¦‚æœ‰é—®é¢˜ï¼Œå¯ä»¥ï¼š
- æŸ¥çœ‹ `configs/adatad/README.md` è·å–è¯¦ç»†æ–‡æ¡£
- æŸ¥çœ‹ OpenTAD GitHub Issues
- é˜…è¯»è®ºæ–‡å’Œç›¸å…³èµ„æ–™

